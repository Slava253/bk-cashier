<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>üëë BK –ö–û–†–û–ù–ê ‚Ä¢ –ö–ê–°–°–ê</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, sans-serif;
        }

        body {
            background: #2b1b0e;
            min-height: 100vh;
            padding: 12px;
        }

        /* –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø */
        .auth-screen {
            background: linear-gradient(145deg, #4a3a2a, #2d1d0c);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 2000;
        }

        .auth-card {
            background: white;
            border-radius: 50px;
            padding: 30px 20px;
            width: 100%;
            max-width: 450px;
            border: 5px solid #fec233;
            text-align: center;
        }

        .auth-card h2 {
            color: #c53a1f;
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .auth-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 3px solid #ba6b3c;
            border-radius: 50px;
            margin: 10px 0;
            text-align: center;
        }

        .auth-btn {
            background: #d49b3b;
            color: white;
            border: none;
            padding: 15px;
            font-size: 1.2rem;
            border-radius: 50px;
            width: 100%;
            cursor: pointer;
            font-weight: 700;
            margin: 10px 0;
            box-shadow: 0 4px 0 #7e491e;
        }

        .auth-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* –û–°–ù–û–í–ù–û–ô –¢–ï–†–ú–ò–ù–ê–õ */
        .terminal {
            max-width: 1400px;
            margin: 0 auto;
            background: #f8f2e6;
            border-radius: 40px;
            overflow: hidden;
            border: 3px solid #fec233;
            display: none;
        }

        .header {
            background: #d62323;
            padding: 15px 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            color: white;
            gap: 10px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .logo i {
            color: #fec233;
        }

        .stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: #2d2d2d;
            padding: 8px 16px;
            border-radius: 40px;
            border: 2px solid #fec233;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-item i {
            color: #fec233;
        }

        /* –î–í–ï –ö–û–õ–û–ù–ö–ò */
        .columns {
            display: flex;
            gap: 20px;
            padding: 20px;
            min-height: calc(100vh - 150px);
        }

        .column {
            flex: 1;
            background: #fef9ef;
            border-radius: 40px;
            padding: 24px;
            border: 3px dashed #d4a373;
            display: flex;
            flex-direction: column;
        }

        .column-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            font-size: 1.8rem;
            font-weight: 800;
            color: #2d1d0c;
            padding-bottom: 15px;
            border-bottom: 3px dashed #d4a373;
        }

        .column-header i {
            color: #c53a1f;
        }

        .badge {
            background: #c53a1f;
            color: white;
            padding: 5px 15px;
            border-radius: 40px;
            font-size: 1.2rem;
            margin-left: 10px;
        }

        /* –ö–ê–†–¢–û–ß–ö–ê –ó–ê–ö–ê–ó–ê */
        .order-card {
            background: white;
            border-radius: 30px;
            padding: 20px;
            margin-bottom: 15px;
            border: 3px solid #ba6b3c;
            box-shadow: 0 6px 0 #8f542e;
            transition: 0.1s;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .order-number {
            font-size: 2.2rem;
            font-weight: 900;
            color: #c53a1f;
        }

        .crowns {
            background: #fec233;
            color: #2d1d0c;
            padding: 8px 15px;
            border-radius: 40px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .crowns i {
            color: #d62323;
        }

        .client-info {
            background: #fff2d7;
            border-radius: 20px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .client-name {
            font-weight: 700;
            color: #c53a1f;
            margin-bottom: 5px;
        }

        .client-phone {
            color: #666;
            font-size: 0.9rem;
        }

        .order-items {
            margin: 15px 0;
            padding: 10px;
            background: #f5ede1;
            border-radius: 15px;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }

        .order-total {
            font-size: 1.3rem;
            font-weight: 800;
            text-align: right;
            margin: 10px 0;
        }

        /* –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 30px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 0 #6a3f19;
            transition: 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .action-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .ready-btn {
            background: #4CAF50;
            color: white;
        }

        .done-btn {
            background: #fec233;
            color: #2d1d0c;
        }

        .crown-btn {
            background: #9c27b0;
            color: white;
        }

        .empty-state {
            text-align: center;
            color: #666;
            padding: 40px 20px;
        }

        .empty-state i {
            font-size: 3rem;
            color: #cbad86;
            margin-bottom: 10px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 60px;
            font-weight: 700;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        @media (max-width: 768px) {
            .columns {
                flex-direction: column;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .order-number {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div id="notification" class="notification">üîî –ù–æ–≤—ã–π –∑–∞–∫–∞–∑!</div>

    <!-- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –ö–ê–°–°–ò–†–ê -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-card">
            <i class="fas fa-crown" style="font-size: 3rem; color: #fec233; margin-bottom: 10px;"></i>
            <h2>üëë BK –ö–û–†–û–ù–ê</h2>
            <p style="margin-bottom: 20px;">–í—Ö–æ–¥ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
            <input type="password" id="passwordInput" class="auth-input" placeholder="–ü–∞—Ä–æ–ª—å" autofocus>
            <button class="auth-btn" onclick="checkPassword()">
                <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
            </button>
            <p style="margin-top: 20px; color: #666;">–ü–∞—Ä–æ–ª—å: 2347</p>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° -->
    <div id="terminal" class="terminal">
        <div class="header">
            <div class="logo">
                <i class="fas fa-crown"></i>
                <span>BK –ö–û–†–û–ù–ê ‚Ä¢ –ö–ê–°–°–ê</span>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <i class="fas fa-clock"></i>
                    <span id="liveTime">12:00:00</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-crown"></i>
                    <span id="totalCrowns">0</span>
                </div>
            </div>
        </div>

        <!-- –î–í–ï –ö–û–õ–û–ù–ö–ò -->
        <div class="columns">
            <!-- –ö–û–õ–û–ù–ö–ê 1: –ì–û–¢–û–í–ò–¢–°–Ø -->
            <div class="column">
                <div class="column-header">
                    <i class="fas fa-clock"></i>
                    <span>–ì–û–¢–û–í–ò–¢–°–Ø</span>
                    <span class="badge" id="waitingCount">0</span>
                </div>
                <div class="orders-list" id="waitingOrders"></div>
            </div>

            <!-- –ö–û–õ–û–ù–ö–ê 2: –ì–û–¢–û–í–û -->
            <div class="column">
                <div class="column-header">
                    <i class="fas fa-check-circle"></i>
                    <span>–ì–û–¢–û–í–û</span>
                    <span class="badge" id="readyCount">0</span>
                </div>
                <div class="orders-list" id="readyOrders"></div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBlZ5ZtyTXgtXxSXJAx1jOxwhTrzlHRJmo",
            authDomain: "bk-cashier.firebaseapp.com",
            databaseURL: "https://bk-cashier-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "bk-cashier",
            storageBucket: "bk-cashier.firebasestorage.app",
            messagingSenderId: "385000840969",
            appId: "1:385000840969:web:1ec8d09176b6551dc0fdd8"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let orders = {};
        let totalCrowns = 0;

        // ========== –ü–†–û–í–ï–†–ö–ê –ü–ê–†–û–õ–Ø ==========
        window.checkPassword = () => {
            const password = document.getElementById('passwordInput').value;
            if (password === '2347') {
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('terminal').style.display = 'block';
                initCashier();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
            }
        };

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        function initCashier() {
            updateTime();
            loadTotalCrowns();
            setupFirebaseListener();
            setInterval(updateTime, 1000);
        }

        // ========== –ñ–ò–í–´–ï –ß–ê–°–´ ==========
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ru-RU');
            document.getElementById('liveTime').innerText = timeStr;
        }

        // ========== –ó–ê–ì–†–£–ó–ö–ê –ö–û–†–û–ù ==========
        function loadTotalCrowns() {
            db.ref('crowns/total').on('value', (snapshot) => {
                totalCrowns = snapshot.val() || 0;
                document.getElementById('totalCrowns').innerText = totalCrowns;
            });
        }

        // ========== –°–õ–£–®–ê–¢–ï–õ–¨ –ó–ê–ö–ê–ó–û–í ==========
        function setupFirebaseListener() {
            db.ref('orders').on('child_added', (snapshot) => {
                const order = snapshot.val();
                const orderNum = snapshot.key;
                
                if (order.status !== 'done') {
                    orders[orderNum] = { ...order, status: order.status || 'waiting' };
                    showNotification('–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ #' + orderNum);
                    updateDisplays();
                    if (navigator.vibrate) navigator.vibrate(200);
                }
            });

            db.ref('orders').on('child_changed', (snapshot) => {
                const order = snapshot.val();
                const orderNum = snapshot.key;
                
                if (order.status === 'done') {
                    delete orders[orderNum];
                } else if (orders[orderNum]) {
                    orders[orderNum].status = order.status;
                }
                
                updateDisplays();
            });
        }

        // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–û–í ==========
        function updateDisplays() {
            const waitingDiv = document.getElementById('waitingOrders');
            const readyDiv = document.getElementById('readyOrders');
            
            let waitingHtml = '';
            let readyHtml = '';
            let waitingCount = 0;
            let readyCount = 0;
            
            Object.entries(orders).forEach(([num, data]) => {
                const itemsList = data.items.map(i => 
                    `<div class="order-item"><span>${i.name} x${i.quantity}</span><span>${i.price * i.quantity} ‚ÇΩ</span></div>`
                ).join('');
                
                const crownBonus = Math.floor(data.total / 100);
                
                if (data.status === 'waiting') {
                    waitingCount++;
                    waitingHtml += `
                        <div class="order-card">
                            <div class="order-header">
                                <span class="order-number">#${num}</span>
                                <span class="crowns"><i class="fas fa-crown"></i> +${crownBonus}</span>
                            </div>
                            <div class="client-info">
                                <div class="client-name"><i class="fas fa-user"></i> ${data.userName || '–ö–ª–∏–µ–Ω—Ç'}</div>
                                ${data.userPhone ? `<div class="client-phone"><i class="fas fa-phone"></i> ${data.userPhone}</div>` : ''}
                            </div>
                            <div class="order-items">${itemsList}</div>
                            <div class="order-total">–°—É–º–º–∞: ${data.total} ‚ÇΩ</div>
                            <div class="action-buttons">
                                <button class="action-btn ready-btn" onclick="moveToReady('${num}')">
                                    <i class="fas fa-check"></i> –ì–û–¢–û–í–û
                                </button>
                            </div>
                        </div>
                    `;
                } else if (data.status === 'ready') {
                    readyCount++;
                    readyHtml += `
                        <div class="order-card">
                            <div class="order-header">
                                <span class="order-number">#${num}</span>
                                <span class="crowns"><i class="fas fa-crown"></i> +${crownBonus}</span>
                            </div>
                            <div class="client-info">
                                <div class="client-name"><i class="fas fa-user"></i> ${data.userName || '–ö–ª–∏–µ–Ω—Ç'}</div>
                                ${data.userPhone ? `<div class="client-phone"><i class="fas fa-phone"></i> ${data.userPhone}</div>` : ''}
                            </div>
                            <div class="order-items">${itemsList}</div>
                            <div class="order-total">–°—É–º–º–∞: ${data.total} ‚ÇΩ</div>
                            <div class="action-buttons">
                                <button class="action-btn done-btn" onclick="completeOrder('${num}')">
                                    <i class="fas fa-hand-holding-heart"></i> –í–´–î–ê–¢–¨
                                </button>
                            </div>
                        </div>
                    `;
                }
            });
            
            waitingDiv.innerHTML = waitingHtml || `
                <div class="empty-state">
                    <i class="fas fa-clock"></i>
                    <p>–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>
                </div>
            `;
            
            readyDiv.innerHTML = readyHtml || `
                <div class="empty-state">
                    <i class="fas fa-check-circle"></i>
                    <p>–ù–µ—Ç –≥–æ—Ç–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤</p>
                </div>
            `;
            
            document.getElementById('waitingCount').innerText = waitingCount;
            document.getElementById('readyCount').innerText = readyCount;
        }

        // ========== –ü–ï–†–ï–ú–ï–°–¢–ò–¢–¨ –í –ì–û–¢–û–í–û ==========
        window.moveToReady = (orderNum) => {
            if (orders[orderNum]) {
                orders[orderNum].status = 'ready';
                db.ref('orders/' + orderNum).update({ 
                    status: 'ready', 
                    readyAt: Date.now() 
                });
                showNotification(`‚úÖ –ó–∞–∫–∞–∑ #${orderNum} –≥–æ—Ç–æ–≤`);
                if (navigator.vibrate) navigator.vibrate(100);
            }
        };

        // ========== –í–´–î–ê–¢–¨ –ó–ê–ö–ê–ó ==========
        window.completeOrder = (orderNum) => {
            if (orders[orderNum]) {
                const order = orders[orderNum];
                const crownBonus = Math.floor(order.total / 100);
                
                // –ù–∞—á–∏—Å–ª—è–µ–º –∫–æ—Ä–æ–Ω—ã
                db.ref('crowns/total').transaction((current) => {
                    return (current || 0) + crownBonus;
                });
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                db.ref('completed_orders/' + orderNum).set({
                    ...order,
                    completedAt: Date.now()
                });
                
                // –£–¥–∞–ª—è–µ–º –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö
                db.ref('orders/' + orderNum).update({ 
                    status: 'done', 
                    doneAt: Date.now() 
                });
                
                delete orders[orderNum];
                showNotification(`üõí –ó–∞–∫–∞–∑ #${orderNum} –≤—ã–¥–∞–Ω +${crownBonus} üëë`);
                updateDisplays();
                if (navigator.vibrate) navigator.vibrate(100);
            }
        };

        // ========== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ==========
        function showNotification(text) {
            const notif = document.getElementById('notification');
            notif.innerHTML = `üîî ${text}`;
            notif.style.display = 'block';
            setTimeout(() => notif.style.display = 'none', 3000);
        }
    </script>
</body>
</html>
